# Supporting information for Random forest model to predict long-term seasonal nitrate and orthophosphate concentrations in British river reaches

- Purpose: Present the model code and data organization for two random forest models (nitrate and orthophosphate) trained to estimate seasonal concentrations at each Great Britain river reach.
- Scope: Two Jupyter notebooks (identical structure) for nitrate and orthophosphate; final models use a two-step approach: train with all features to obtain importances, then train a final model with selected features.

## Data and features

- Input data files:
  - nitrate_readings.csv
  - orthophosphate_readings.csv
  - training_features.csv
  - reaches_no_na.csv
- Feature sources and mapping:
  - Features are generated by matching gridded datasets to the UKCEH digital river network (FEH catchment descriptors and Land Cover Map 2015).
  - Each water quality reading is matched to a river reach in the network.
- Target and data characteristics:
  - Readings are aggregated and log-transformed seasonal values from the Environment Agency Water Quality Archive.
  - SITE_ID (EA water quality site), SEASON, and RESULT (log-transformed seasonal reading, 2010â€“2020).
  - training_features.csv includes site_id, OBJECTID (river reach ID), and a suite of FEH and land cover descriptor features (e.g., CCAR, HGHT, QALT, QASB, QASV, various FEH indices, and land cover fractions).
  - reaches_no_na.csv provides river reaches with no missing values and mirrors the format of training_features.csv.
- Outputs mapping:
  - RF predictions can be mapped back to the river network for visualization and post-analysis.

## Modeling approach

- Two models:
  - Nitrate model for nitrate concentrations.
  - Orthophosphate model for orthophosphate concentrations.
- Feature handling:
  - Initially train with all available features to obtain feature importances.
  - Subsequently train a final model using only the selected (most informative) features.
- Reproducibility:
  - The two notebooks are essentially identical in structure, differing only in the target variable (nitrate vs orthophosphate).

## Data sources and licensing

- Data sources:
  - FEH catchment descriptors and Land Cover Map 2015 used to derive features.
  - EA Water Quality Archive providing seasonal nitrate and orthophosphate readings.
  - UKCEH digital river network used for feature matching and reach-level alignment.
- Licensing:
  - The digital river network dataset is licensed by EIDC and is not included in this submission.
  - External datasets require appropriate access and licensing for use.

## Outputs and usage

- Purpose of outputs:
  - Produce reach-level predictions that can be visualized on the GB river network.
  - Support downstream analyses and dissemination of nutrient concentration estimates.
- Data governance notes:
  - No explicit quality control section is provided in the materials.
  - Data provenance is maintained via explicit file naming and feature source descriptions, aiding traceability.

## Considerations for Data Leaders

- Data availability and discoverability:
  - Features come from multiple datasets (FEH, LCM, EA QAArchive) requiring clear metadata and provenance tracking.
- Data quality and gaps:
  - The dataset relies on aggregated seasonal readings and multiple derived features; potential gaps exist in both readings and feature completeness (reaches_no_na.csv covers non-missing cases).
- Metadata and standards:
  - Metadata is embedded in file descriptions; formal metadata standards would improve discoverability and interoperability.
- Collaboration and reuse:
  - The approach supports sharing the modeling pipeline (notebooks) and the feature-engineering workflow, enabling cross-site reuse with similar river-network contexts.
- Governance implications:
  - Ensure licensing compliance for the digital river network and external data sources; document data lineage and update cycles for model refreshes.

## Useful links

- UKCEH digital river network of Great Britain (1:50,000): https://catalogue.ceh.ac.uk/documents/7d5e42b6-7729-46c8-99e9-f9e4efddde1d
- Land Cover Map 2015 (GB): https://doi.org/10.5285/7115bc48-3ab0-475d-84ae-fd3126c20984
- National river flow archive flood estimation handbook catchment descriptors: https://nrfa.ceh.ac.uk/feh-catchment-descriptors
- Environmental Agency Water Quality Archive: https://environment.data.gov.uk/water-quality/view/landing