# Supporting information for Random forest model to predict long-term seasonal nitrate and orthophosphate concentrations in British river reaches

- Purpose and scope
  - Provides model code and data structure details for the paper River reach-level machine learning estimation of nutrient concentrations in Great Britain (Frontiers in Water, 2023).
  - Describes two random forest models (nitrate and orthophosphate) trained at each river reach in Great Britain, including feature selection and final model training.

- Modelling approach
  - Two Jupyter notebooks (identical in structure) train random forest models using observed readings to predict seasonal nitrate or orthophosphate levels at each river reach.
  - Process:
    - Train with all features to derive feature importances.
    - Re-train a final model using a selected subset of features.
  - Inputs are matched to a GB river network and mapped for visualization and post-analysis.

- Data sources and inputs
  - Input features (training_features.csv) generated by linking gridded datasets to the UKCEH digital river network (FEH catchment descriptors and Land Cover Map 2015).
  - Water quality readings (nitrate_readings.csv, orthophosphate_readings.csv) from Environment Agency's Water Quality Archive; fields include:
    - SITE_ID (EA water quality site ID)
    - SEASON (Spring, Summer, Autumn, Winter)
    - RESULT (log-transformed seasonal reading; 2010â€“2020)
  - River reach mapping:
    - OBJECTID (river reach ID) and SITE_ID linked to EA sites.
    - reaches_no_na.csv contains river reaches across GB with no missing values, used for predictions.
  - Feature examples from training_features.csv include a wide set of FEH descriptors and land-cover fractions, such as:
    - CCAR, HGHT, QALT, QASB, QASV, QUI various FEH-based indices and hydrological descriptors
    - Land cover fractions (e.g., URBLOC, ARABLE AND HORTICULTURE, GRASSLAND, WOODLAND, WATER)
  - STATION in reaches_no_na.csv corresponds to OBJECTID in training_features.csv.

- Data structure and files
  - nitrate_model_for_the_paper_including_feat_selection.ipynb
  - orthophosphate_model_for_the_paper_including_feat_selection.ipynb
  - nitrate_readings.csv
  - orthophosphate_readings.csv
  - training_features.csv (river reaches matched to EA sites; FEH and land-cover features)
  - reaches_no_na.csv (GB-wide river reaches, no missing values)
  - Note: The digital UKCEH river network dataset is not included in this submission due to separate licensing (EIDC).

- Output and usage
  - Final model predictions can be mapped to the river network for visualization and downstream analysis.
  - The approach supports long-term, reach-level monitoring of nutrient concentrations, aiding policy evaluation and decision-making.

- Data governance, access, and limitations
  - The river network dataset is licensed separately and not provided here, limiting full replication of network mapping.
  - Data sources include publicly available EA water quality archives and FEH/land-cover datasets; metadata and dataset provenance are embedded in the feature descriptions.
  - The use of log-transformed seasonal readings helps stabilize variance and interpretability of model outputs.

- Relevance for monitoring frameworks
  - Demonstrates an explicit method to generate span-long, reach-level nutrient concentration estimates by integrating multiple data sources and transparent feature engineering.
  - Provides a replicable workflow (notebook-based) for policymakers and monitoring teams to implement, validate, and adapt to different regions or nutrients.
  - Highlights practical considerations for monitoring data pipelines, including data alignment, feature selection, and licensing constraints that affect data accessibility and governance.

- Useful links
  - UKCEH digital river network of Great Britain (1:50,000): https://catalogue.ceh.ac.uk/documents/7d5e42b6-7729-46c8-99e9-f9e4efddde1d
  - Land Cover Map 2015 (1km) GB: https://doi.org/10.5285/7115bc48-3ab0-475d-84ae-fd3126c20984
  - National river flow archive flood estimation handbook catchment descriptors: https://nrfa.ceh.ac.uk/feh-catchment-descriptors
  - Environmental Agency Water Quality Archive: https://environment.data.gov.uk/water-quality/view/landing