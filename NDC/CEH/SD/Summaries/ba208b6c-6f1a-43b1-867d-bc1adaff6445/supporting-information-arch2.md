# Supporting information for Random forest model to predict long-term seasonal nitrate and orthophosphate concentrations in British river reaches

## Overview
- Provides model codes (two Jupyter notebooks) for predicting long-term seasonal nitrate and orthophosphate concentrations at GB river reaches using random forests.
- Two notebooks are essentially identical, one for nitrate and one for orthophosphate; each trains a model on observed readings, first with all features to derive feature importances, then a final model with a selected subset of features.
- Outputs are intended to support mapping predictions onto the UK river network for visualization and post-analysis.

## Data sources and inputs
- Environmental Agency Water Quality Archive: seasonal, log-transformed readings (2010â€“2020) used as target variables.
  - nitrate_readings.csv
  - orthophosphate_readings.csv
  - Columns include SITE_ID (EA water quality site ID), SEASON (Spring, Summer, Autumn, Winter), and RESULT (log-transformed seasonal average).
- Training features and river reaches
  - training_features.csv: includes SITE_ID, OBJECTID (river reach ID), and a suite of catchment descriptors and land-cover fractions (from FEH and Land Cover Map 2015).
  - reaches_no_na.csv: GB-wide river reach dataset with non-missing features, formatted like training_features.csv, used for predictions.
  - The input features are generated by matching gridded datasets (FEH catchment characteristics and Land Cover Map 2015) to the UKCEH digital river network; each water quality reading is matched to a reach.
- Digital river network
  - The digital GB river network is not included in this submission due to licensing (licensed by EIDC).

## Modeling approach
- Random forest models trained separately for nitrate and orthophosphate.
- Modeling steps per nutrient:
  - Train with all available features to obtain feature importances.
  - Train a final model using only the selected (imported) features.
- Predictions are produced per river reach and can be mapped onto the river network for visualization and downstream analyses.

## Input features and data structure
- Feature sources include:
  - FEH catchment descriptors (e.g., depth of precipitation, mean catchment altitude, catchment slope, base flow index, flood attenuation indices, drainage characteristics).
  - Land Cover Map 2015 fractions (e.g., urban, arable, grassland, woodland, water, coastal, etc.).
- Key columns in training_features.csv / reaches_no_na.csv (examples):
  - site_id (EA water quality site ID)
  - OBJECTID / STATION (river reach ID)
  - CCAR, HGHT, QALT, QASB, QASV, QB19, QBFI, QDPB, QDPS, QFAR, QFPD, QFPL, QFPX, QLDP, QPRW, PROPWET, QR1D, QR1H, QR2D, QS47, QS69, QSPR, QUC2, QUCO, QUE2, QUEX, QUL2, QULO, and various land-cover fractions (ARABLE AND HORTICULTURE, COASTAL, GRASSLAND, HEATH/BOG, INLAND ROCK, URBAN, WATER, WOODLAND) along with UNKNOWN categories.
- The data structure is designed to align EA site readings with corresponding river reaches and gridded catchment/land-cover descriptors.

## Outputs and mapping
- RF predictions for nitrate and orthophosphate can be mapped to the GB river network for visualization and downstream analyses.
- The notebooks generate model outputs using the prepared reaches_no_na.csv, enabling nationwide reach-level nutrient concentration estimates.

## File contents
- nitrate_model_for_the_paper_including_feat_selection.ipynb
- orthophosphate_model_for_the_paper_including_feat_selection.ipynb
- nitrate_readings.csv
- orthophosphate_readings.csv
- training_features.csv
- reaches_no_na.csv
- Note: The two notebooks are essentially identical aside from the target nutrient they model.

## Licensing and access
- The digital UKCEH river network dataset is not included due to licensing and is available separately from EIDC.
- Useful external datasets and datasets referenced for feature construction and validation are linked in the document.

## Useful links (referenced datasets)
- UKCEH digital river network of Great Britain (1:50,000)
- Land Cover Map 2015 (1km percentage aggregates GB)
- National river flow archive / Flood Estimation Handbook catchment descriptors
- Environmental Agency Water Quality Archive