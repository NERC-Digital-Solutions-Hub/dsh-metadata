# CP_Fish_HydrologyStats

## Overview
- Contains extracted flow statistics for NRFA gauging stations matched to fish survey sites.
- Data covers 12 months prior to each fish survey and only includes stations with daily flow records spanning the relevant period.
- One region-specific file per region: CP_Fish_HydrologyStats_Region.csv (regions include Anglian, Midlands, North East, North West, Thames, Southern and South West).
- Generated under WP1 Hydrology data matched statistics as part of the chempop project.

## Provenance and Access
- Source: National River Flow Archive (NRFA) data archived and hosted by CEH.
- Generated by: Rachel Ainsworth (r.ainsworth@hull.ac.uk) and Virginie Keller (vke@ceh.ac.uk).
- Licensing: © UKCEH; data from OS and public sector information licensed under OGL v3.0; Crown copyright and database rights.

## Data Content and Structure
- File structure: One CSV file per region (CP_Fish_HydrologyStats_Region.csv); each file contains extracted statistics for all fish sample sites in that region.
- Key identifiers:
  - Fish_SiteID, Fish_Easting, Fish_Northing, Fish_SurveyDate
  - RF_Matched_Feature_ID (gauge station ID matched to site)
- Relationship to other data: Fish_SiteID matches IDs in other datasets (DataTable, SiteTable, chemical determinand).
- Columns: Approximately 100 variables per region file.
- Core data types:
  - Period of record statistics for the full period of record (mean, q50, sd, cov, q5.mean, q95.mean).
  - Threshold statistics for 3-, 6-, and 12-month periods preceding each survey, across 5%, 25%, 75%, and 95% thresholds:
    - threshold (quantile), duration_exceeded, n_exceedences, avg_patch_length
  - Column naming convention: {n}_{period}_{P}_{stat} (e.g., 12M_POI_threshold, 3M_precper_n_exceedences, etc.).

## Methods and Processing
- Data matching:
  - NRFA gauging stations snapped to the nearest line on the river network using Euclidean distance, then converted to a polygon to support network splitting.
  - River network distance used to assign the nearest NRFA station to each fish survey site.
  - ArcGIS (10.8+ or Pro) used for matching; Python (with os, shapely, pandas, geopandas, matplotlib, numpy, network) for extraction.
  - Manual QA performed to verify matches due to errors in automated matching.
- Timeframe:
  - Period of record spans 1974/05/20 to 2019/03/29 (earliest sample date minus the largest preceding period to the most recent sample date).
  - Time series extracted for 12 months prior to each fish survey.
- Statistics calculated:
  - Full-period statistics: mean, median (q50), sd, cov, q5.mean, q95.mean.
  - Pre-survey period statistics (3, 6, 12 months): threshold quantiles (5/25/75/95), days exceeded as a fraction of period, number of exceedance events, and average patch length (days exceeded per exceedance).
- QA notes:
  - Some automated matching errors required manual verification.
  - Missing data coded as NA; less than 1% missing in matching period.

## Data Definitions and Column Details
- Core identifying fields: Fish_SiteID, Fish_Easting, Fish_Northing, Fish_SurveyDate, RF_Matched_Feature_ID.
- Period-of-record statistics: mean, q50, sd, cov, q5.mean, q95.mean.
- Threshold statistics: for each combination of n (3M, 6M, 12M), period (precper, POI), percentile (5%, 25%, 75%, 95%), and stat (threshold, duration_exceeded, n_exceedences, avg_patch_length) — corresponding column holds the described statistic.
- Data completeness: Missing data coded as NA; very low missingness (<1%).

## Software and Tools Used
- Arc GIS (map or Pro) for visualization and spatial matching.
- Python 3 with libraries: os, shapely, pandas, geopandas, matplotlib, numpy, network for data extraction and matching.

## Versioning and Availability
- Data package contains region-specific files; no multiple versions indicated for the dataset.