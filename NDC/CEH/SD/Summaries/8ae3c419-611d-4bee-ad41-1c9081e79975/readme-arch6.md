# Supplementary Information for EIDCHELP-82246, 'Python code to identify sources of chemical pollutants in waterways'

- This repository accompanies the manuscript “Apportioning sources of chemicals of emerging concern along an urban river with inverse modelling” by Chrapkiewicz et al. (submitted to Science of the Total Environment). It is a snapshot of the SourceApp repository and provides materials to reproduce results.

## Collection and generation methods
- Source apportionment code uses waterway network topology and downstream conservative mixing with measured concentrations to invert for source locations and concentrations.
- Builds on convex optimization methods for efficient source apportionment (influenced by prior work on sediment sources).
- Principal code developer: K. Chrapkiewicz; collaborators include A. Lipp, R. Barnes, and Gareth Roberts.
- Project funded via a six-month NERC Exploring the Frontiers grant.

## Nature and units of recorded values
- Chemical concentrations are recorded in ng/L.
- Inversions are based on data originally generated by L. Barron and colleagues (Egli et al., 2023).

## Quality control
- A synthetic data inversion was performed.
- Analyses include Analysis of Variance (ANOVA) and uncertainty assessment.
- Additional methodological details are available in the supporting documentation and cited papers.

## Details of the repository structure
- Data directory contains publicly available data to reproduce results:
  - ICL_London_Dataset2019-2021.csv (raw chemicals data from Egli et al., 2022)
  - LIDAR_Composite_10m_DTM_2022_521500_540000_151500_179500.tif (digital elevation model)
  - Thames_d8.nc (digital drainage network)
- Figures/apportionment contains multiple pollutant figures (e.g., Acetamiprid, Cocaine, Tramadol, etc.) and standardized panels (observed vs. predicted, 1:1 plots, regularisation vs data misfit, subcatchment concentrations, and uncertainties).
- Examples/mwe.py provides a minimal working example to illustrate usage.
- Top-level mwe.yaml is the installation configuration file.

## Installation and running
- Steps (Unix-like environment; conda recommended):
  - Clone the repository (and note SourceApp is included if updates are not needed).
  - Create and activate a conda environment using the provided mwe.yaml.
  - Install required packages:
    - autocatchments (from GitHub)
    - faster-unmixer (from GitHub, with submodules)
  - Run the Minimum Working Example:
    - cd SourceApp/examples
    - python mwe.py
  - Open generated PNGs to view results.
- Recommended Python version: Python 3.11 in the conda environment.

## Outputs and data products
- Outputs include calculated subcatchment (source) concentrations and corresponding uncertainty estimates.
- Outputs are designed to be self-explanatory via the figure panels (observed vs. predicted, regularisation experiments, and concentration maps).

## How to cite
- If using any part of this repository in research, cite:
  - Chrapkiewicz, Kajetan; Lipp, Alex; Barron, Leon Patrick; Barnes, Richard; Roberts, Gareth (2024), “Apportioning sources of chemicals of emerging concern along an urban river with inverse modelling.” Science of the Total Environment. Preprint: SSRN.

## References (contextual)
- Egli et al. (2023) on one-health environmental risk assessment for contaminants of emerging concern.
- Barnes & Lipp (2024) on convex optimization for source apportionment.
- Lipp et al. (2020, 2021) on source region geochemistry and unmixing downstream compositions.